<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="á»¨ng dá»¥ng quáº£n lÃ½ há»c táº­p cho lá»›p 10A1 - Sá»­ dá»¥ng Ä‘Æ°á»£c offline">
  <title>Class Hub - Quáº£n lÃ½ há»c táº­p lá»›p 10A1</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='60' font-size='80' text-anchor='middle'>ğŸ“š</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23667eea' width='180' height='180'/><text x='90' y='100' font-size='90' font-weight='bold' fill='white' text-anchor='middle'>ğŸ“š</text></svg>">
  <link rel="stylesheet" href="style/hub.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <header class="header">
    <div class="header-content">
      <h1>ğŸ“š HUB Lá»šP 10A1</h1>
      <p>Trung tÃ¢m quáº£n lÃ½ há»c táº­p</p>
      <div class="header-right">
        <button class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()" style="display:none;" title="Cháº¿ Ä‘á»™ Admin">âš™ï¸</button>
        <button class="logout-btn" onclick="handleLogout()" title="ÄÄƒng xuáº¥t">
          <span id="userNameDisplay">ğŸ‘¤</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Thá»‘ng kÃª -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-icon">ğŸ“‹</span>
        <div class="stat-content">
          <span class="stat-label">Tá»•ng Task</span>
          <span class="stat-value" id="totalTask">0</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ”„</span>
        <div class="stat-content">
          <span class="stat-label">Äang má»Ÿ</span>
          <span class="stat-value" id="openTask">0</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">âœ…</span>
        <div class="stat-content">
          <span class="stat-label">HoÃ n thÃ nh</span>
          <span class="stat-value" id="doneTask">0</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">â°</span>
        <div class="stat-content">
          <span class="stat-label">Sáº¯p háº¿t háº¡n</span>
          <span class="stat-value" id="nearDeadline">0</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Äiá»u hÆ°á»›ng -->
  <section class="nav-section">
    <h2>Äiá»u hÆ°á»›ng</h2>
    <div class="nav-grid">
      <button class="nav-btn nav-btn-primary" onclick="go('/nhiemvu/nv.html')">
        <span class="nav-icon">ğŸ“Œ</span>
        <span class="nav-text">Nhiá»‡m vá»¥</span>
      </button>
      <button class="nav-btn nav-btn-success" onclick="go('/thongke/tk.html')">
        <span class="nav-icon">âœ…</span>
        <span class="nav-text">Thá»‘ng kÃª</span>
      </button>
      <button class="nav-btn nav-btn-info" onclick="go('/thongbao/tb.html')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">ThÃ´ng bÃ¡o</span>
      </button>
      <button class="nav-btn nav-btn-info" onclick="go('/lich/lich.html')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-text">Lá»‹ch há»c</span>
      </button>
    </div>
  </section>

  <!-- Task gáº§n nháº¥t -->
  <section class="recent-section">
    <h2>â° Task gáº§n nháº¥t</h2>
    <ul class="recent-list" id="recentTasks">
      <!-- Ná»™i dung Ä‘Æ°á»£c táº¡o bá»Ÿi script -->
    </ul>
  </section>

  <footer class="footer">
    <p>&copy; 2025 Lá»›p 10A1. Táº¥t cáº£ quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
  </footer>

<script src="script/hub.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
<script src="script/firebase-config.js"></script>
<script>firebase.initializeApp(firebaseConfig);</script>
<script src="script/firebase-utils.js"></script>
<script src="script/students-list.js"></script>
<script src="script/hub.js"></script>

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(registration => {
          console.log('âœ… Service Worker Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½:', registration);

          // Kiá»ƒm tra update má»—i 10 giÃ¢y
          setInterval(() => {
            registration.update();
          }, 10000);

          // Láº¯ng nghe cáº­p nháº­t service worker
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // CÃ³ service worker má»›i
                console.log('ğŸ”„ PhiÃªn báº£n má»›i cÃ³ sáºµn! Nháº¥n F5 Ä‘á»ƒ cáº­p nháº­t.');
                // Tá»± Ä‘á»™ng reload trang sau 2 giÃ¢y
                setTimeout(() => {
                  window.location.reload();
                }, 2000);
              }
            });
          });
        })
        .catch(error => {
          console.log('âŒ Service Worker Ä‘Äƒng kÃ½ tháº¥t báº¡i:', error);
        });
    });
  }

  // Check user login
  window.addEventListener('load', () => {
    if (!isLoggedIn()) {
      window.location.href = 'login.html';
      return;
    }

    const user = getCurrentUser();
    console.log('âœ… ÄÃ£ Ä‘Äƒng nháº­p:', user.name);
    document.getElementById('userNameDisplay').textContent = user.name;

    // Hiá»‡n nÃºt Admin náº¿u lÃ  admin
    if (isAdmin()) {
      document.getElementById('adminToggle').style.display = 'inline-block';
    }
  });

  // Xá»­ lÃ½ Ä‘Äƒng xuáº¥t
  function handleLogout() {
    if (confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘Äƒng xuáº¥t?')) {
      logoutUser();
      window.location.href = 'login.html';
    }
  }

  // Toggle cháº¿ Ä‘á»™ Admin (áº©n/hiá»‡n nÃºt admin)
  let adminMode = false;
  function toggleAdminMode() {
    adminMode = !adminMode;
    console.log(adminMode ? 'ğŸ”“ Cháº¿ Ä‘á»™ Admin ON' : 'ğŸ”’ Cháº¿ Ä‘á»™ Admin OFF');
    // CÃ³ thá»ƒ thÃªm logic Ä‘á»ƒ hiá»‡n/áº©n nÃºt quáº£n lÃ½ dá»¯ liá»‡u
  }

  // Gá»£i Ã½ ngÆ°á»i dÃ¹ng cÃ i Ä‘áº·t á»©ng dá»¥ng
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', event => {
    event.preventDefault();
    deferredPrompt = event;
    // Báº¡n cÃ³ thá»ƒ hiá»ƒn thá»‹ nÃºt cÃ i Ä‘áº·t táº¡i Ä‘Ã¢y náº¿u muá»‘n
  });

  // Kiá»ƒm tra káº¿t ná»‘i máº¡ng
  window.addEventListener('online', () => {
    console.log('âœ… Báº¡n Ä‘Ã£ online');
  });

  window.addEventListener('offline', () => {
    console.log('âš ï¸ Báº¡n Ä‘Ã£ offline - Sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã£ cached');
  });
</script>