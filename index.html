<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="á»¨ng dá»¥ng quáº£n lÃ½ há»c táº­p cho lá»›p 10A1 - Sá»­ dá»¥ng Ä‘Æ°á»£c offline">
  <title>10C7 AIO</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='60' font-size='80' text-anchor='middle'>ğŸ“š</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23667eea' width='180' height='180'/><text x='90' y='100' font-size='90' font-weight='bold' fill='white' text-anchor='middle'>ğŸ“š</text></svg>">
  <link rel="stylesheet" href="style/hub.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <h1>ğŸ“š Lá»›p há»c 10C7</h1>
        <p>Trung tÃ¢m quáº£n lÃ½ há»c táº­p</p>
      </div>
      <div class="header-right">
        <button class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()" style="display:none;" title="Cháº¿ Ä‘á»™ Admin">âš™ï¸</button>
        <button class="logout-btn" onclick="handleLogout()" title="ÄÄƒng xuáº¥t">
          <span id="userNameDisplay">ğŸ‘¤</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Welcome Banner -->
  <section class="welcome-section">
    <div class="welcome-content">
      <h2>ğŸ‘‹ Xin chÃ o, <span id="welcomeName">báº¡n</span>!</h2>
      <p id="welcomeMessage">ChÃºc báº¡n má»™t ngÃ y há»c táº­p hiá»‡u quáº£!</p>
    </div>
  </section>

  <!-- Thá»‘ng kÃª -->
  <section class="stats-section">
    <h2 class="section-title">ğŸ“Š Tá»•ng Quan Há»c Táº­p</h2>
    <div class="stats-grid">
      <div class="stat-card" onclick="go('nhiemvu/nv.html')">
        <div class="stat-icon-wrapper">
          <span class="stat-icon">ğŸ“‹</span>
        </div>
        <div class="stat-content">
          <span class="stat-label">Tá»•ng Task</span>
          <span class="stat-value" id="totalTask">0</span>
        </div>
        <div class="stat-indicator"></div>
      </div>
      <div class="stat-card" onclick="go('nhiemvu/nv.html')">
        <div class="stat-icon-wrapper">
          <span class="stat-icon">ğŸ”„</span>
        </div>
        <div class="stat-content">
          <span class="stat-label">Äang má»Ÿ</span>
          <span class="stat-value" id="openTask">0</span>
        </div>
        <div class="stat-indicator"></div>
      </div>
      <div class="stat-card" onclick="go('thongke/tk.html')">
        <div class="stat-icon-wrapper">
          <span class="stat-icon">âœ…</span>
        </div>
        <div class="stat-content">
          <span class="stat-label">HoÃ n thÃ nh</span>
          <span class="stat-value" id="doneTask">0</span>
        </div>
        <div class="stat-indicator success"></div>
      </div>
      <div class="stat-card" onclick="go('nhiemvu/nv.html')">
        <div class="stat-icon-wrapper">
          <span class="stat-icon">â°</span>
        </div>
        <div class="stat-content">
          <span class="stat-label">Sáº¯p háº¿t háº¡n</span>
          <span class="stat-value" id="nearDeadline">0</span>
        </div>
        <div class="stat-indicator warning"></div>
      </div>
    </div>
  </section>

  <!-- Äiá»u hÆ°á»›ng -->
  <section class="nav-section">
    <h2 class="section-title">ğŸš€ Äiá»u HÆ°á»›ng Nhanh</h2>
    <div class="nav-grid">
      <button class="nav-btn nav-btn-primary" onclick="go('nhiemvu/nv.html')">
        <span class="nav-icon">ğŸ“Œ</span>
        <span class="nav-text">Nhiá»‡m vá»¥</span>
        <span class="nav-desc">Quáº£n lÃ½ cÃ´ng viá»‡c</span>
      </button>
      <button class="nav-btn nav-btn-success" onclick="go('thongke/tk.html')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Thá»‘ng kÃª</span>
        <span class="nav-desc">Xem tiáº¿n Ä‘á»™</span>
      </button>
      <button class="nav-btn nav-btn-info" onclick="go('thongbao/tb.html')">
        <span class="nav-icon">ğŸ””</span>
        <span class="nav-text">ThÃ´ng bÃ¡o</span>
        <span class="nav-desc">Cáº­p nháº­t tin tá»©c</span>
      </button>
      <button class="nav-btn nav-btn-calendar" onclick="go('lich/lich.html')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-text">Lá»‹ch há»c</span>
        <span class="nav-desc">Xem thá»i khoÃ¡ biá»ƒu</span>
      </button>
      
      <!-- Admin Buttons (Integrated) -->
      <button class="nav-btn" id="btnNavStudents" onclick="go('hoso/hs.html')" style="display:none; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white;">
        <span class="nav-icon">ğŸ‘¨â€ğŸ“</span>
        <span class="nav-text">Há»c sinh</span>
        <span class="nav-desc">Quáº£n lÃ½ há»“ sÆ¡</span>
      </button>
      <button class="nav-btn" id="btnNavRoles" onclick="go('perm/pq.html')" style="display:none; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-text">PhÃ¢n quyá»n</span>
        <span class="nav-desc">Cáº¥p quyá»n chá»©c vá»¥</span>
      </button>
      <button class="nav-btn" id="btnNavLogs" onclick="go('logs/nk.html')" style="display:none; background: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%); color: white;">
        <span class="nav-icon">ğŸ“œ</span>
        <span class="nav-text">Logs</span>
        <span class="nav-desc">Nháº­t kÃ½ hoáº¡t Ä‘á»™ng</span>
      </button>
    </div>
  </section>

  <!-- Task gáº§n nháº¥t -->
  <section class="recent-section">
    <div class="section-header">
      <h2>â° Task Gáº§n Háº¡n</h2>
      <a href="nhiemvu/nv.html" class="view-all">Xem táº¥t cáº£ â†’</a>
    </div>
    <div class="recent-container">
      <ul class="recent-list" id="recentTasks">
        <!-- Ná»™i dung Ä‘Æ°á»£c táº¡o bá»Ÿi script -->
      </ul>
      <div class="empty-state" id="emptyState" style="display: none;">
        <span class="empty-icon">ğŸ‰</span>
        <p>KhÃ´ng cÃ³ task sáº¯p háº¿t háº¡n!</p>
      </div>
    </div>
  </section>

  <footer class="footer">
    <p>&copy; 2025 Lá»›p 10A1. Táº¥t cáº£ quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
    <p class="online-status" id="onlineStatus">ğŸŸ¢ Online</p>
  </footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="script/firebase-config.js"></script>
<script>firebase.initializeApp(firebaseConfig);</script>
<script src="script/firebase-utils.js"></script>
<script src="script/students-list.js"></script>
<script src="script/hub.js"></script>

<!-- Service Worker Registration -->
<script>
  // Check user login
  window.addEventListener('load', () => {
    if (!isLoggedIn()) {
      window.location.href = buildUrl('login.html');
      return;
    }

    const user = getCurrentUser();
    console.log('âœ… ÄÃ£ Ä‘Äƒng nháº­p:', user.name);
    document.getElementById('userNameDisplay').textContent = user.name;

    // Hiá»‡n nÃºt Admin náº¿u lÃ  admin
    if (isAdmin()) {
      document.getElementById('adminToggle').style.display = 'inline-block';
    }

    // Cáº­p nháº­t welcome message
    updateWelcomeMessage();
    
    // Load stats
    loadStats();
    
    // Cáº­p nháº­t tráº¡ng thÃ¡i káº¿t ná»‘i
    updateOnlineStatus();
    
    // Táº£i láº¡i stats má»—i 30 giÃ¢y
    setInterval(() => {
      loadStats();
    }, 30000);
  });

  // Xá»­ lÃ½ Ä‘Äƒng xuáº¥t
  function handleLogout() {
    if (confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘Äƒng xuáº¥t?')) {
      logoutUser();
      window.location.href = buildUrl('login.html');
    }
  }

  // Toggle cháº¿ Ä‘á»™ Admin
  let adminMode = false;
  function toggleAdminMode() {
    adminMode = !adminMode;
    console.log(adminMode ? 'ğŸ”“ Cháº¿ Ä‘á»™ Admin ON' : 'ğŸ”’ Cháº¿ Ä‘á»™ Admin OFF');
  }

  // Gá»£i Ã½ ngÆ°á»i dÃ¹ng cÃ i Ä‘áº·t á»©ng dá»¥ng
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', event => {
    event.preventDefault();
    deferredPrompt = event;
  });

  // Kiá»ƒm tra káº¿t ná»‘i máº¡ng
  window.addEventListener('online', () => {
    console.log('âœ… Báº¡n Ä‘Ã£ online');
  });

  window.addEventListener('offline', () => {
    console.log('âš ï¸ Báº¡n Ä‘Ã£ offline - Sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã£ cached');
  });
</script>